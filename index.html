<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Casa Mia</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#A8E063">

  <link rel="icon" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Casa Mia">
</head>

<body style="font-family:sans-serif;text-align:center;padding-top:40px">
  <h2>Casa Mia</h2>
  <p id="msg">Cargando aplicaci√≥n‚Ä¶</p>

  <button id="installBtn" style="
    display:none;
    padding:15px 25px;
    font-size:16px;
    background:#A8E063;
    border:none;
    border-radius:8px;
    cursor:pointer;
  ">
    üì≤ Instalar Casa Mia
  </button>

  <script>
    const APP_URL = "https://www.appsheet.com/start/111884a5-30bd-45d9-a382-196fde4884a6";

    const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches;

    if (isMobile) {
      // Si est√° instalada ‚Üí abrir AppSheet
      if (isStandalone) {
        window.location.replace(APP_URL);
      }

      // Manejar instalaci√≥n PWA
      let deferredPrompt = null;

      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;

        document.getElementById('msg').innerText = "Instal√° la app para un acceso r√°pido";
        document.getElementById('installBtn').style.display = 'inline-block';
      });

      document.getElementById('installBtn').addEventListener('click', async () => {
        if (!deferredPrompt) {
          alert("Us√° el men√∫ ‚ãÆ y toc√° ‚ÄúInstalar Casa Mia‚Äù");
          return;
        }
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        window.location.replace(APP_URL);
      });

      // Fallback si Chrome no dispara evento
      setTimeout(() => {
        if (!deferredPrompt) {
          document.getElementById('msg').innerText =
            "Abr√≠ el men√∫ ‚ãÆ y toc√° ‚ÄúInstalar Casa Mia‚Äù";
        }
      }, 1500);

    } else {
      // Mensaje para escritorio
      document.getElementById('msg').innerText =
        "Esta aplicaci√≥n funciona mejor en un celular. Abr√≠ este enlace desde tu dispositivo m√≥vil:";
      
      // Mostrar el link directo
      const link = document.createElement('a');
      link.href = APP_URL;
      link.innerText = "Abrir Casa Mia";
      link.style.display = "block";
      link.style.marginTop = "20px";
      link.style.fontSize = "18px";
      link.target = "_blank";

      document.body.appendChild(link);
    }
  </script>
</body>
</html>
